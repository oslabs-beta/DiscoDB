!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self).myLibrary={})}(this,(function(e){"use strict";const o=require("fs"),t=require("path");function n(e,r){const s=t.join(e,r);try{return data=o.readFileSync(s,"utf-8"),JSON.parse(data)}catch(o){if(t.dirname(e)!==e)return n(t.dirname(e),r)}}const r=(s="discodb.config.json",n(t.dirname(require.main.filename),s));var s;console.log(r);const c={DB:null},i=[];r.onlineRoutes.forEach((e=>{i.push(e.url)}));const a=[];function l(e){return new Promise(((o,t)=>{let n=indexedDB.open(r.databaseName,r.version);n.onerror=e=>{console.log("Error: ",e),c.DB=null,t(e)},n.onupgradeneeded=e=>{let o=e.target.result;o.objectStoreNames.contains(r.storeName)||o.createObjectStore(r.storeName,{keyPath:r.keypath}),o.objectStoreNames.contains(r.syncQueue)||o.createObjectStore(r.syncQueue,{keyPath:"id",autoIncrement:!0})},n.onsuccess=t=>{c.DB=t.target.result,e&&e(),o(c.DB)}}))}function u(e){return new Promise(((o,t)=>{if(e&&c.DB){let n=c.DB.transaction(r.storeName,"readwrite");n.onerror=e=>{console.log("Error:",e),t(e)},n.oncomplete=e=>{},n.objectStore(r.storeName).put(e).onsuccess=e=>{const t=e.target.result;o(t)}}else console.log("DB is not connected")}))}function d(){return new Promise(((e,o)=>{if(c.DB){let t=c.DB.transaction(r.storeName,"readwrite");t.onerror=e=>{console.log("Error:",e),o(e)},t.oncomplete=e=>{};t.objectStore(r.storeName).clear().onsuccess=o=>{const t=o.target.result;e(t)}}else console.log("DB is not connected")}))}function f(){return new Promise(((e,o)=>{if(c.DB){let t=c.DB.transaction(r.storeName,"readonly");t.onerror=e=>{console.log("Error: ",e),o(e)},t.oncomplete=e=>{};t.objectStore(r.storeName).getAll().onsuccess=o=>{const t=o.target.result;e(t)}}else console.log("DB is not connected")}))}function m(e){return new Promise(((o,t)=>{if(c.DB){let n=c.DB.transaction(r.storeName,"readwrite");n.onerror=e=>{console.log("Error: ",e),t(e)},n.oncomplete=e=>{};n.objectStore(r.storeName).delete(e).onsuccess=e=>{const t=e.target.result;o(t)}}else console.log("DB is not connected")}))}function y(e){return new Promise(((o,t)=>{if(c.DB){let n=c.DB.transaction(r.storeName,"readwrite");n.onerror=e=>{console.log("Error: ",e),t(e)},n.oncomplete=e=>{};n.objectStore(r.storeName).put(e).onsuccess=e=>{const t=e.target.result;o(t)}}else console.log("DB is not connected")}))}function g(e,o){return c.DB.transaction([e],o).objectStore(e)}function h(e){g(r.syncQueue,"readwrite").add(e)}async function p(){try{return await registration.sync.register("discoSync")}catch(e){return console.log("Error:",e),e}}r.offlineRoutes.forEach((e=>{a.push(e.url)})),e.discoAdd=u,e.discoAddToQueue=h,e.discoConnect=l,e.discoDeleteAll=d,e.discoDeleteOne=m,e.discoGetAll=f,e.discoRegisterSync=p,e.discoSyncOffline=function(e,o,t){switch(e){case"GET":return c.DB?f().then((e=>{const o={data:e};return new Response(JSON.stringify(o))})):l((()=>{f().then((e=>{const o={data:e};return new Response(JSON.stringify(o))}))}));case"DELETE":return t.json().then((t=>{const n={url:o,method:e,body:t};p(),h(n);m(t[r.keypath]);return new Response(JSON.stringify({}))})).catch((e=>{console.log("Error in DELETE block: ",e)}));case"PATCH":return t.json().then((t=>{const n={url:o,method:e,body:t};p(),h(n);t[r.keypath],y(t);return new Response(JSON.stringify({}))}));default:return caches.match(t).then((e=>e))}},e.discoSyncOnline=function(e,o,t){if("GET"===e){t.json().then((e=>{c.DB?d():l((()=>{d()})),e.data.forEach((e=>{c.DB?u(e):l((()=>{u(e)}))}))}))}},e.discoSyncToServer=function(){const e=g(r.syncQueue,"readwrite").getAll();e.onsuccess=function(e){e.target.result.forEach((e=>{const{url:o,method:t,body:n}=e;fetch(o,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((o=>{g(r.syncQueue,"readwrite").delete(e.id)})).catch((e=>{throw console.error("Failed to sync data to server:",e),e}))}))},e.onerror=e=>{console.log("Attempt to sync queue failed:",e)}},e.discoUpdateOne=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=bundle.umd.min.js.map
